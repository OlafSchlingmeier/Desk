*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="cit_tapi.vcx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS ctapi AS container 
 	*< CLASSDATA: Baseclass="container" Timestamp="" Scale="Pixels" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="otapiex" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*m: dodial
		*m: dodialcancel
		*m: doinitialize
		*m: doinitialize_line		&& Tries to initialize TAPI line. When error occurs, log it into hotel.err and show message, but allow user to continue to use the system.
		*m: oncallerid
		*m: ondebug
		*m: ondialconnected
		*m: ondialdisconnected
		*m: onendcall
		*m: onidle
		*m: oninfo
		*m: onnewcall
		*m: onring
		*p: clinename
		*p: ldebug
		*p: ocurrentcall
	*</DefinedPropArrayMethod>

	clinename = 
	Height = 200
	ldebug = .F.
	Name = "ctapi"
	ocurrentcall = .NULL.
	Width = 200

	ADD OBJECT 'otapiex' AS olecontrol WITH ;
		Height = 100, ;
		Left = 12, ;
		Name = "otapiex", ;
		Top = 12, ;
		Width = 100
		*< END OBJECT: BaseClass="olecontrol" OLEObject="c:\files\dev\code\source\vfp\citadel\desk\common\dll\tapiexct.dll" Value="0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOARB0TC9tUBAwAAAAACAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfAEAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAA4AAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAQAAAAAAAAAAwAAAP7////+////BAAAAAUAAAAGAAAABwAAAP7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8h420l8AI4QoEWKkDmLdv+AAgAACADAAAgAwAACAACAAAAAAAIAAIAAAAAAAMAAACgAAgAOAAAADgALAAwADAAOAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwACAAawBIAHoAOwAgADEANgAgAEIAaQB0ADsAIABNAG8AbgBvACAAUABDAE0AAAAIAEoAAAAwADEAMAAwADAAMQAwADAANAAwADEARgAwADAAMAAwADgAMAAzAEUAMAAwADAAMAAwADIAMAAwADEAMAAwADAAMAAwADAAMAAAAAMAAAAAAAMAAAAAAAMAHgAAAAsAAAADAP////8DAGQAAAAIAAIAAAAAAAgAAgAAAAAACwABAAMAAAAAAAQAAADAwAsAAAALAAEACwABAAgAEgAAAHcAYQB2AGUALwBvAHUAdAAAAAgAEAAAAHcAYQB2AGUALwBpAG4AAAAIACIAAAAuAFwAVABBAFAASQBFAHgAXwBsAG8AZwAuAHQAeAB0AAAACwAAAAsAAAALAAAAAwAAAAAAAwAAAAAAAAAAAA==" />
	
	PROCEDURE dodial
		LPARAMETERS lp_cPhoneNumber
		LOCAL l_oLine, l_lSuccess
		
		IF EMPTY(lp_cPhoneNumber)
			RETURN l_lSuccess
		ENDIF
		
		l_oLine = this.otapiex.Lines(this.clinename)
		
		IF VARTYPE(l_oLine)="O"
			this.ocurrentcall = l_oLine.MakeCall(lp_cPhoneNumber)
			l_lSuccess = .T.
		ENDIF
		
		RETURN l_lSuccess
	ENDPROC

	PROCEDURE dodialcancel
		LOCAL l_lSuccess
		IF VARTYPE(this.ocurrentcall)="O"
			l_lSuccess = this.ocurrentcall.drop()
		ENDIF
		
		RETURN l_lSuccess
	ENDPROC

	PROCEDURE doinitialize
		LPARAMETERS lp_cTapiDriverName, lp_lDebug, lp_lForTapiDriverSetup
		LOCAL l_oLine, l_lSuccess
		
		IF EMPTY(lp_cTapiDriverName) AND NOT lp_lForTapiDriverSetup
		     RETURN l_lSuccess
		ENDIF
		
		IF NOT lp_lForTapiDriverSetup
		     this.cLineName = lp_cTapiDriverName
		ENDIF
		
		this.lDebug = lp_lDebug
		IF this.ldebug
		     this.otapiex.logfile = _screen.oGlobal.choteldir + "tapiex_" + LOWER(ALLTRIM(_screen.oGlobal.oTerminal.tm_winname)) + ".log"
		     IF lp_lForTapiDriverSetup
		          this.ldebug = .F.
		     ENDIF
		ELSE
		     this.otapiex.logfile = ""
		ENDIF
		
		this.otapiex.aboutSerialNumber = "Ds90LK-AWqOHDKzOV8AoymvTRMhtCNE9sYWYgU2NobGluZ21laWVyLCBDaXRhZGVsIEhvdGVsc29mdHdhcmUgR21iSAD9FKc="
		
		this.otapiex.initialize()
		
		IF NOT lp_lForTapiDriverSetup
		
		     l_oLine = this.doinitialize_line()
		
		     IF VARTYPE(l_oLine) = "O"
		          l_lSuccess = l_oLine.Open()
		     ENDIF
		
		ENDIF
		
		RETURN l_lSuccess
	ENDPROC

	PROCEDURE doinitialize_line		&& Tries to initialize TAPI line. When error occurs, log it into hotel.err and show message, but allow user to continue to use the system.
		LOCAL l_lSuccess, l_oLine, l_oException AS Exception, l_cErrorText
		
		l_lSuccess = .T.
		l_oLine = .NULL.
		
		TRY
		     l_oLine = this.otapiex.Lines(this.cLineName)
		CATCH TO l_oException
		     l_lSuccess = .F.
		     ASSERT .F. MESSAGE PROGRAM()
		ENDTRY
		
		IF l_lSuccess
		     RETURN l_oLine
		ENDIF
		
		
		TEXT TO l_cErrorText TEXTMERGE NOSHOW PRETEXT 3
		<<TRANSFORM(DATETIME())>> TAPI initialize error
		-------------------------------------
		<<this.cLineName>>
		-------------------------------------
		ErrorNo:<<TRANSFORM(l_oException.ErrorNo)>>
		Message:<<TRANSFORM(l_oException.Message)>>
		Procedure:<<TRANSFORM(l_oException.Procedure)>>
		LineNo:<<TRANSFORM(l_oException.LineNo)>>
		LineContents:<<TRANSFORM(l_oException.LineContents)>>
		Details:<<TRANSFORM(l_oException.Details)>>
		ENDTEXT
		
		LogData(l_cErrorText, "hotel.err")
		
		= msGbox(l_cErrorText,gcApplication,016)
		
		RETURN l_oLine
	ENDPROC

	PROCEDURE oncallerid
		LPARAMETERS m_call, callername, callernumber
		
		this.Parent.TapiOnCallerId(m_call, callername, callernumber)
	ENDPROC

	PROCEDURE ondebug
		LPARAMETERS lp_cMsg
		
		this.Parent.TapiOnDebug(lp_cMsg)
	ENDPROC

	PROCEDURE ondialconnected
		LPARAMETERS lp_call, lp_connectedmode
		
		this.Parent.TapiOnDialConnected(lp_call, lp_connectedmode)
	ENDPROC

	PROCEDURE ondialdisconnected
		LPARAMETERS m_call, disconnectedmode
		
		this.Parent.TapiOnDialDisconnected(m_call, disconnectedmode)
	ENDPROC

	PROCEDURE onendcall
		LPARAMETERS m_line
		this.Parent.TapiOnEndCall(m_line)
	ENDPROC

	PROCEDURE onidle
		LPARAMETERS m_call
		
		this.Parent.TapiOnIdle(m_call)
	ENDPROC

	PROCEDURE oninfo
		LPARAMETERS infocode, infostring
		
		this.Parent.TapiOnInfo(infocode, infostring)
	ENDPROC

	PROCEDURE onnewcall
		LPARAMETERS m_call
		
		this.Parent.TapiOnNewCall(m_call)
	ENDPROC

	PROCEDURE onring
		LPARAMETERS m_call, ringcount
		
		this.Parent.TapiOnRing(m_call, ringcount)
	ENDPROC

	PROCEDURE otapiex.Oncallerid
		*** ActiveX Control Event ***
		LPARAMETERS m_call, callername, callernumber
		
		this.Parent.OnCallerId(m_call, callername, callernumber)
	ENDPROC

	PROCEDURE otapiex.OnConnected
		*** ActiveX Control Event ***
		LPARAMETERS m_call, connectedmode
		
		this.Parent.OnDialConnected(m_call, connectedmode)
	ENDPROC

	PROCEDURE otapiex.Ondebug
		*** ActiveX Control Event ***
		LPARAMETERS msg
		
		IF this.Parent.ldebug
		     this.Parent.OnDebug(msg)
		ENDIF
	ENDPROC

	PROCEDURE otapiex.OnDisConnected
		*** ActiveX Control Event ***
		LPARAMETERS m_call, disconnectedmode
		
		this.Parent.OnDialDisConnected(m_call, disconnectedmode)
	ENDPROC

	PROCEDURE otapiex.Onendcall
		*** ActiveX Control Event ***
		LPARAMETERS m_line
		
		this.Parent.OnEndCall(m_line)
		
		this.Parent.ocurrentcall = .NULL.
	ENDPROC

	PROCEDURE otapiex.Onidle
		*** ActiveX Control Event ***
		LPARAMETERS m_call
		
		this.Parent.OnIdle(m_call)
	ENDPROC

	PROCEDURE otapiex.Oninfo
		*** ActiveX Control Event ***
		LPARAMETERS infocode, infostring
		
		this.Parent.OnInfo(infocode, infostring)
	ENDPROC

	PROCEDURE otapiex.Onnewcall
		*** ActiveX Control Event ***
		LPARAMETERS m_call
		
		this.Parent.OnNewCall(m_call)
	ENDPROC

	PROCEDURE otapiex.Onring
		*** ActiveX Control Event ***
		LPARAMETERS m_call, ringcount
		
		this.Parent.OnRing(m_call, ringcount)
	ENDPROC

ENDDEFINE
